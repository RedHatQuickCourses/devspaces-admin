<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring the Kubernetes Image Puller :: Red Hat OpenShift Dev Spaces Administration</title>
    <link rel="prev" href="che-cluster.html">
    <link rel="next" href="fuse-overlay.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../..">Red Hat OpenShift Dev Spaces Administration</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/devspaces-admin/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="devspaces-admin" data-version="3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Red Hat OpenShift Dev Spaces Administration</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Home</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="install.html">Install</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operator.html">OpenShift Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cli.html">CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="gitops.html">GitOps</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="upgrade.html">Upgrade</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="remove.html">Uninstall</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="config.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="che-cluster.html">CheCluster CR</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="image-puller.html">Image Puller</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fuse-overlay.html">fuse-overlayfs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat OpenShift Dev Spaces Administration</span>
    <span class="version">3</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Red Hat OpenShift Dev Spaces Administration</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">3</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat OpenShift Dev Spaces Administration</a></li>
    <li><a href="config.html">Configuration</a></li>
    <li><a href="image-puller.html">Image Puller</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configuring the Kubernetes Image Puller</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In the previous lab, you would have noted that it took a long time for the Workspace to start and display the IDE, even if the Workspace was empty (No source code tree). Dev Spaces loads a default container image (called the <strong>Universal Developer Image - UDI</strong>) in a Workspace if you did not specify one explicitly. To reduce the start-up time of workspaces, use the <strong>Image Puller</strong>, an OpenShift component that can be used to pre-pull and cache container images.</p>
</div>
<div class="paragraph">
<p>The Image Puller is an additional OpenShift deployment that creates a <code>DaemonSet</code> that can be configured to pre-pull relevant OpenShift Dev Spaces workspace images on each node. These images would already be available when an OpenShift Dev Spaces workspace starts, therefore improving the workspace start-up time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dev Spaces, by default caches container images at the OpenShift node level. For example, if <code>user1</code> downloads a 5GB container image, and if his workspace is scheduled on <code>node1</code> of an OpenShift cluster, then if <code>user2</code> uses the same container image in his workspace, which is also scheduled on <code>node1</code>, then <code>user2</code> will see faster start-up time of his workspace due to caching. However, if <code>user2</code> workspace is scheduled on <code>node2</code>, which does NOT have the container images cached, he will see increased start-up time while the 5GB image is downloaded on <code>node2</code>. The Kubernetes image puller solves this problem by caching a list of container images on <strong>every</strong> node in the OpenShift cluster.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_configure_the_kubernetes_image_puller"><a class="anchor" href="#_lab_configure_the_kubernetes_image_puller"></a>Lab: Configure the Kubernetes Image Puller</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Like in previous exercises, you can use <code>oc</code> CLI or GitOps approach to configuring the YAML files. You will start by installing the <code>Kubernetes Image Puller</code> operator on OpenShift. Prepare the following <code>Subscription</code> resource in a file named <code>image-puller-sub.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  annotations:
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
    argocd.argoproj.io/sync-wave: "2"
  name: kubernetes-imagepuller-operator
  namespace: openshift-devspaces
spec:
  channel: stable
  installPlanApproval: Automatic
  name: kubernetes-imagepuller-operator
  source: community-operators
  sourceNamespace: openshift-marketplace
  startingCSV: kubernetes-imagepuller-operator.v1.1.0</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc apply -f image-puller-sub.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to the <code>Operators &gt; Installed Operators</code> page of the OpenShift web console, select <code>openshift-devspaces</code> in the <code>Project</code> drop-down, and verify that the Kubernetes Image Puller operator is installed successfully.</p>
<div class="imageblock">
<div class="content">
<img src="_images/img-puller-op-installed.png" alt="img puller op installed">
</div>
<div class="title">Figure 1. Kubernetes Image Puller Operator Installed</div>
</div>
</li>
<li>
<p>You need a list of container images that you need the image puller to pre-pull before workspace start. Navigate to the following URL and grab the list of container images. You can also add other third party and custom container images to the list.</p>
<div class="paragraph">
<p><a href="https://&lt;openshift_dev_spaces_fqdn&gt;/plugin-registry/v3/external_images.txt" class="bare">https://&lt;openshift_dev_spaces_fqdn&gt;/plugin-registry/v3/external_images.txt</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">registry.redhat.io/devspaces/udi-rhel8:3.15
registry.redhat.io/devspaces/idea-rhel8:3.15
registry.redhat.io/devspaces/code-rhel8:3.15</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>devspaces</code> CheCluster CR YAML configuration and configure the image puller:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: org.eclipse.che/v2
kind: CheCluster
metadata:
  name: devspaces
  namespace: openshift-devspaces
  annotations:
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
    argocd.argoproj.io/sync-wave: "3"
spec:
  components:
...
    devfileRegistry: {}
    *imagePuller:
      enable: true <i class="conum" data-value="1"></i><b>(1)</b>
      spec:
        images: &gt;- <i class="conum" data-value="2"></i><b>(2)</b>
          registry.redhat.io/devspaces/udi-rhel8:3.15;registry.redhat.io/devspaces/idea-rhel8:3.15;registry.redhat.io/devspaces/code-rhel8:3.15
        ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>- Enable the image puller</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>- List of images to pre-pull on OpenShift nodes separated by semi-colon (";")</td>
</tr>
</table>
</div>
</li>
<li>
<p>Navigate back to the <code>Operators &gt; Installed Operators</code> page in the OpenShift web console. Click <code>Kubernetes Image Puller</code> in the <code>Provided APIs</code> column. Observe that a new instance of <code>KubernetesImagePuller</code> CR, named <code>devspaces-image-puller</code> is now active. Click on <code>devspaces-image-puller</code> and verify that your list of images is listed in the <code>Images to pull</code> field at the bottom of the screen.</p>
<div class="imageblock">
<div class="content">
<img src="_images/image-puller-list.png" alt="image puller list">
</div>
<div class="title">Figure 2. List of images to pull</div>
</div>
</li>
<li>
<p>Try and launch workspaces as different users and notice that apart from the first Workspace launch, subsequent launches should be faster because the container images have been cached.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can identify which container images are being launched in a Workspace, by clicking on the <code>Events</code> tab when you launch a Workspace from the Dev Spaces dashboard.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/workspace-image-pull.png" alt="workspace image pull">
</div>
<div class="title">Figure 3. Container images in a Workspace</div>
</div>
<div class="paragraph">
<p>You can also run the following command in the namespace (in the format <em>&lt;username&gt;-devspaces</em>) created for the user, to view the container images pulled for the Workspace:</p>
</div>
<div class="paragraph">
<p><strong>oc get events -n user1-devspaces </strong></p>
</div>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="che-cluster.html">CheCluster CR</a></span>
  <span class="next"><a href="fuse-overlay.html">fuse-overlayfs</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
